<div class="edit-cantiere-container">
  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="loading-spinner">
      <svg class="spinner" width="48" height="48" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
          <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
          <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
        </circle>
      </svg>
      <p>Caricamento cantiere...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="error-container">
    <div class="error-message">
      {{ error() }}
    </div>
    <button class="btn btn-secondary" (click)="goBack()">
      Torna ai Cantieri
    </button>
  </div>

  <!-- Form Content -->
  <div *ngIf="!loading() && !error()">
    <div class="page-header">
      <nav class="breadcrumb">
        <a href="/admin" class="breadcrumb-link">Admin</a>
        <span class="breadcrumb-separator">‚Ä¢</span>
        <a href="/admin/cantieri" class="breadcrumb-link">Cantieri</a>
        <span class="breadcrumb-separator">‚Ä¢</span>
        <span class="breadcrumb-current">{{ cantiere()?.nome || 'Modifica Cantiere' }}</span>
      </nav>
      <h1>üèóÔ∏è Modifica Cantiere</h1>
      <p>Aggiorna le informazioni del cantiere selezionato.</p>
    </div>

    <form [formGroup]="cantiereForm" (ngSubmit)="onSubmit()" class="cantiere-form">
      <!-- Informazioni Generali -->
      <div class="form-section">
        <h2>üìã Informazioni Generali</h2>
        <p>Dettagli principali del cantiere e della localizzazione</p>

        <div class="form-row">
          <div class="form-group">
            <label for="nome">Nome Cantiere *</label>
            <input 
              type="text" 
              id="nome" 
              formControlName="nome"
              placeholder="Es. Villa Rossi - Ristrutturazione"
              [class.error]="hasError('nome', 'required')"
            />
            <div class="error-message" *ngIf="hasError('nome', 'required')">
              {{ getErrorMessage('nome') }}
            </div>
          </div>

          <div class="form-group">
            <label for="stato">Stato *</label>
            <select id="stato" formControlName="stato" [class.error]="hasError('stato', 'required')">
              <option value="">Seleziona stato</option>
              <option *ngFor="let stato of statoOptions" [value]="stato">
                {{ getStatoLabel(stato) }}
              </option>
            </select>
            <div class="error-message" *ngIf="hasError('stato', 'required')">
              {{ getErrorMessage('stato') }}
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="ristrutturazione_id">ID Ristrutturazione</label>
          <input 
            type="text" 
            id="ristrutturazione_id" 
            formControlName="ristrutturazione_id"
            placeholder="Codice di riferimento della ristrutturazione"
          />
        </div>
      </div>

      <!-- Localizzazione -->
      <div class="form-section">
        <h2>üìç Localizzazione</h2>
        <p>Indirizzo e dettagli geografici del cantiere</p>

        <div class="form-group">
          <label for="indirizzo">Indirizzo *</label>
          <input 
            type="text" 
            id="indirizzo" 
            formControlName="indirizzo"
            placeholder="Via, numero civico"
            [class.error]="hasError('indirizzo', 'required')"
          />
          <div class="error-message" *ngIf="hasError('indirizzo', 'required')">
            {{ getErrorMessage('indirizzo') }}
          </div>
        </div>

        <div class="form-row three-cols">
          <div class="form-group">
            <label for="citta">Citt√† *</label>
            <input 
              type="text" 
              id="citta" 
              formControlName="citta"
              placeholder="Nome della citt√†"
              [class.error]="hasError('citta', 'required')"
            />
            <div class="error-message" *ngIf="hasError('citta', 'required')">
              {{ getErrorMessage('citta') }}
            </div>
          </div>

          <div class="form-group">
            <label for="cap">CAP</label>
            <input 
              type="text" 
              id="cap" 
              formControlName="cap"
              placeholder="00000"
              maxlength="5"
            />
          </div>

          <div class="form-group">
            <label for="provincia">Provincia</label>
            <input 
              type="text" 
              id="provincia" 
              formControlName="provincia"
              placeholder="Sigla provincia"
              maxlength="2"
              style="text-transform: uppercase"
            />
          </div>
        </div>
      </div>

      <!-- Informazioni Cliente -->
      <div class="form-section">
        <h2>üë§ Informazioni Cliente</h2>
        <p>Dati di contatto del cliente committente</p>

        <div class="form-row">
          <div class="form-group">
            <label for="cliente_nome">Nome</label>
            <input 
              type="text" 
              id="cliente_nome" 
              formControlName="cliente_nome"
              placeholder="Nome del cliente"
            />
          </div>

          <div class="form-group">
            <label for="cliente_cognome">Cognome</label>
            <input 
              type="text" 
              id="cliente_cognome" 
              formControlName="cliente_cognome"
              placeholder="Cognome del cliente"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="cliente_telefono">Telefono</label>
            <input 
              type="tel" 
              id="cliente_telefono" 
              formControlName="cliente_telefono"
              placeholder="3XX XXX XXXX"
            />
          </div>

          <div class="form-group">
            <label for="cliente_email">Email</label>
            <input 
              type="email" 
              id="cliente_email" 
              formControlName="cliente_email"
              placeholder="cliente@email.com"
              [class.error]="hasError('cliente_email', 'email')"
            />
            <div class="error-message" *ngIf="hasError('cliente_email', 'email')">
              {{ getErrorMessage('cliente_email') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Pianificazione Temporale -->
      <div class="form-section">
        <h2>üìÖ Pianificazione Temporale</h2>
        <p>Date importanti per la gestione del progetto</p>

        <div class="form-row three-cols">
          <div class="form-group">
            <label for="data_inizio">Data Inizio</label>
            <input 
              type="date" 
              id="data_inizio" 
              formControlName="data_inizio"
            />
          </div>

          <div class="form-group">
            <label for="data_fine_prevista">Data Fine Prevista</label>
            <input 
              type="date" 
              id="data_fine_prevista" 
              formControlName="data_fine_prevista"
            />
          </div>

          <div class="form-group">
            <label for="data_fine_effettiva">Data Fine Effettiva</label>
            <input 
              type="date" 
              id="data_fine_effettiva" 
              formControlName="data_fine_effettiva"
            />
          </div>
        </div>
      </div>

      <!-- Budget e Costi -->
      <div class="form-section">
        <h2>üí∞ Budget e Costi</h2>
        <p>Gestione finanziaria del cantiere</p>

        <div class="form-row">
          <div class="form-group">
            <label for="budget">Budget Previsto (‚Ç¨)</label>
            <input 
              type="number" 
              id="budget" 
              formControlName="budget"
              placeholder="0.00"
              min="0"
              step="0.01"
              [class.error]="hasError('budget', 'min')"
            />
            <div class="error-message" *ngIf="hasError('budget', 'min')">
              {{ getErrorMessage('budget') }}
            </div>
          </div>

          <div class="form-group">
            <label for="costo_effettivo">Costo Effettivo (‚Ç¨)</label>
            <input 
              type="number" 
              id="costo_effettivo" 
              formControlName="costo_effettivo"
              placeholder="0.00"
              min="0"
              step="0.01"
              [class.error]="hasError('costo_effettivo', 'min')"
            />
            <div class="error-message" *ngIf="hasError('costo_effettivo', 'min')">
              {{ getErrorMessage('costo_effettivo') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Note e Stato -->
      <div class="form-section">
        <h2>üìù Note e Configurazione</h2>
        <p>Informazioni aggiuntive e impostazioni</p>

        <div class="form-group">
          <label for="note">Note</label>
          <textarea 
            id="note" 
            formControlName="note"
            placeholder="Note aggiuntive sul cantiere, specifiche tecniche, osservazioni..."
            rows="4"
          ></textarea>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="is_attivo" />
            <span class="checkbox-text">Cantiere attivo</span>
            <small>I cantieri attivi sono visibili nelle ricerche e nei report</small>
          </label>
        </div>
      </div>

      <!-- Messaggio di errore generale -->
      <div class="error-message" *ngIf="error()">
        {{ error() }}
      </div>

      <!-- Azioni -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="goBack()"
          [disabled]="saving()"
        >
          <span>Annulla</span>
        </button>

        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="saving()"
        >
          <svg *ngIf="saving()" class="spinner" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
              <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
              <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
            </circle>
          </svg>
          <span>{{ saving() ? 'Salvataggio...' : 'Salva Modifiche' }}</span>
        </button>
      </div>
    </form>
  </div>
</div>