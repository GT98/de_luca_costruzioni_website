<app-hero-banner [title]="project()?.title" [isPortfolioDetail]="true" [imageUrl]="project()?.cover_img"
    [bannerMode]="'full'">
</app-hero-banner>

<main class="portfolio-detail-main">
    @if(loading()) {
    <div>Caricamento...</div>
    }

    @if(project()) {
    <section>
        <h1 class="detail-title">{{ project().title }}</h1>
        <div class="detail-description">{{ project().description }}</div>

        <h1 class="detail-title">Prima</h1>
        <!-- Gallery Swiper specifico per portfolio-detail -->
        <div class="portfolio-detail-gallery">
            <div class="swiper portfolio-detail-swiper">
                <div class="swiper-wrapper">
                    @if((this.project().immagini.beforeImages ?? []).length === 0) {
                    <div class="swiper-slide portfolio-detail-slide">
                        <div class="project-card">
                            <div class="project-image-wrapper placeholder">
                                <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                                    <!-- Sfondo -->
                                    <rect width="800" height="600" fill="#f8f9fa" />

                                    <!-- Decorazione geometrica superiore -->
                                    <path d="M 0,0 L 800,0 L 800,200 L 0,150 Z" fill="#19669F" opacity="0.1" />

                                    <!-- Icona casa stilizzata al centro -->
                                    <g transform="translate(400, 280)">
                                        <!-- Base casa -->
                                        <rect x="-80" y="-20" width="160" height="120" fill="#19669F" opacity="0.2"
                                            rx="4" />

                                        <!-- Tetto -->
                                        <path d="M -100,-20 L 0,-80 L 100,-20 Z" fill="#19669F" opacity="0.3" />

                                        <!-- Porta -->
                                        <rect x="-25" y="40" width="50" height="60" fill="#19669F" opacity="0.4"
                                            rx="2" />

                                        <!-- Finestre -->
                                        <rect x="-65" y="10" width="30" height="30" fill="#19669F" opacity="0.5"
                                            rx="2" />
                                        <rect x="35" y="10" width="30" height="30" fill="#19669F" opacity="0.5"
                                            rx="2" />

                                        <!-- Icona strumenti ristrutturazione -->
                                        <g transform="translate(70, -60)">
                                            <path d="M 0,0 L 8,0 L 8,25 L 0,25 Z" fill="#19669F" opacity="0.6" />
                                            <circle cx="4" cy="28" r="3" fill="#19669F" opacity="0.6" />
                                        </g>
                                        <g transform="translate(85, -55)">
                                            <path d="M 0,5 L 15,5 L 15,8 L 0,8 Z" fill="#19669F" opacity="0.6" />
                                            <path d="M 0,0 L 3,0 L 3,20 L 0,20 Z" fill="#19669F" opacity="0.6" />
                                        </g>
                                    </g>

                                    <text x="400" y="520" font-family="Arial, sans-serif" font-size="48" fill="#6c757d"
                                        text-anchor="middle">
                                        Immagini in arrivo
                                    </text>

                                    <!-- Decorazione geometrica inferiore -->
                                    <path d="M 0,600 L 800,600 L 800,450 L 0,500 Z" fill="#19669F" opacity="0.05" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    }
                    @if((this.project().immagini.beforeImages ?? []).length > 0) {
                    @for(img of this.project().immagini.beforeImages; track img.id) {
                    <div class="swiper-slide portfolio-detail-slide">
                        <div class="project-card">
                            <div class="project-image-wrapper" (click)="openFullscreenByUrl(img.url)">
                                <img [src]="img.url" [alt]="project().title" class="project-image" loading="lazy">
                            </div>
                        </div>
                    </div>
                    }
                    }
                </div>
                <div class="portfolio-detail-pagination swiper-pagination"></div>
            </div>
        </div>
        <!-- Fullscreen overlay (always in DOM, visibility controlled by .open) -->
        <div class="portfolio-fullscreen-overlay" [class.open]="fullscreenOpen" (click)="onOverlayClick($event)">
            <button class="pf-close" (click)="closeFullscreen()">×</button>

            <div class="swiper portfolio-fullscreen-swiper">
                <div class="swiper-wrapper">
                    @for(img of fullscreenImages; track img.id) {
                    <div class="swiper-slide">
                        <div class="fs-image-wrapper">
                            <img [src]="img.url" [alt]="project().title" loading="lazy">
                        </div>
                    </div>
                    }
                </div>
                <div class="portfolio-fullscreen-pagination swiper-pagination"></div>
            </div>

            <div class="swiper portfolio-fullscreen-thumbs">
                <div class="swiper-wrapper">
                    @for(img of fullscreenImages; track img.id) {
                    <div class="swiper-slide">
                        <img [src]="img.url" [alt]="project().title" loading="lazy">
                    </div>
                    }
                </div>
            </div>
        </div>

        <!--Dopo-->
        <h1 class="detail-title">Dopo</h1>
        <!-- Gallery Swiper specifico per portfolio-detail -->
        <div class="portfolio-detail-gallery">
            <div class="swiper portfolio-detail-swiper">
                <div class="swiper-wrapper">
                    @if((this.project().immagini.afterImages ?? []).length === 0) {
                    <div class="swiper-slide portfolio-detail-slide">
                        <div class="project-card">
                            <div class="project-image-wrapper placeholder">
                                <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                                    <!-- Sfondo -->
                                    <rect width="800" height="600" fill="#f8f9fa" />

                                    <!-- Decorazione geometrica superiore -->
                                    <path d="M 0,0 L 800,0 L 800,200 L 0,150 Z" fill="#19669F" opacity="0.1" />

                                    <!-- Icona casa stilizzata al centro -->
                                    <g transform="translate(400, 280)">
                                        <!-- Base casa -->
                                        <rect x="-80" y="-20" width="160" height="120" fill="#19669F" opacity="0.2"
                                            rx="4" />

                                        <!-- Tetto -->
                                        <path d="M -100,-20 L 0,-80 L 100,-20 Z" fill="#19669F" opacity="0.3" />

                                        <!-- Porta -->
                                        <rect x="-25" y="40" width="50" height="60" fill="#19669F" opacity="0.4"
                                            rx="2" />

                                        <!-- Finestre -->
                                        <rect x="-65" y="10" width="30" height="30" fill="#19669F" opacity="0.5"
                                            rx="2" />
                                        <rect x="35" y="10" width="30" height="30" fill="#19669F" opacity="0.5"
                                            rx="2" />

                                        <!-- Icona strumenti ristrutturazione -->
                                        <g transform="translate(70, -60)">
                                            <path d="M 0,0 L 8,0 L 8,25 L 0,25 Z" fill="#19669F" opacity="0.6" />
                                            <circle cx="4" cy="28" r="3" fill="#19669F" opacity="0.6" />
                                        </g>
                                        <g transform="translate(85, -55)">
                                            <path d="M 0,5 L 15,5 L 15,8 L 0,8 Z" fill="#19669F" opacity="0.6" />
                                            <path d="M 0,0 L 3,0 L 3,20 L 0,20 Z" fill="#19669F" opacity="0.6" />
                                        </g>
                                    </g>

                                    <!-- Testo -->
                                    <text x="400" y="450" font-family="Arial, sans-serif" font-size="48" fill="#19669F"
                                        text-anchor="middle" font-weight="600">
                                        Appartamento Ristrutturato
                                    </text>

                                    <text x="400" y="480" font-family="Arial, sans-serif" font-size="36" fill="#6c757d"
                                        text-anchor="middle">
                                        Immagine in arrivo
                                    </text>

                                    <!-- Decorazione geometrica inferiore -->
                                    <path d="M 0,600 L 800,600 L 800,450 L 0,500 Z" fill="#19669F" opacity="0.05" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    }
                    @if((this.project().immagini.afterImages ?? []).length > 0) {
                    @for(img of this.project().immagini.afterImages; track img.id) {
                    <div class="swiper-slide portfolio-detail-slide">
                        <div class="project-card">
                            <div class="project-image-wrapper" (click)="openFullscreenByUrl(img.url)">
                                <img [src]="img.url" [alt]="project().title" class="project-image" loading="lazy">
                            </div>
                        </div>
                    </div>
                    }
                    }
                </div>
                <div class="portfolio-detail-pagination swiper-pagination"></div>
            </div>
        </div>
    </section>
    }

    @if(!project() && !loading()) {
    <section>
        <p>Progetto non trovato.</p>
    </section>
    }

    <!-- Sezione navigazione tra progetti -->
    @if(project()) {
    <section class="portfolio-detail-navigation">
        <div class="nav-container">
            @if(previousProject) {
            <button class="nav-button nav-prev" (click)="navigateToProject(previousProject.id)" title="Progetto precedente">
                <span class="nav-icon">←</span>
                <span class="nav-label">Precedente</span>
            </button>
            } @else {
            <button class="nav-button nav-prev" disabled title="Nessun progetto precedente">
                <span class="nav-icon">←</span>
                <span class="nav-label">Precedente</span>
            </button>
            }

            <button class="nav-button nav-home" (click)="goToPortfolio()" title="Torna alla lista progetti">
                <span class="nav-icon">⊞</span>
                <span class="nav-label">Portfolio</span>
            </button>

            @if(nextProject) {
            <button class="nav-button nav-next" (click)="navigateToProject(nextProject.id)" title="Prossimo progetto">
                <span class="nav-label">Successivo</span>
                <span class="nav-icon">→</span>
            </button>
            } @else {
            <button class="nav-button nav-next" disabled title="Nessun prossimo progetto">
                <span class="nav-label">Successivo</span>
                <span class="nav-icon">→</span>
            </button>
            }
        </div>
    </section>
    }
</main>

<app-follow-on></app-follow-on>