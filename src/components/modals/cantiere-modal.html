@if (isOpen) {
<div class="modal-overlay" (click)="close()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Modifica Cantiere' : 'Nuovo Cantiere' }}</h2>
      <button class="btn-close" (click)="close()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <form [formGroup]="cantiereForm" (ngSubmit)="save()">
      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="nome">Nome Cantiere *</label>
            <input type="text" id="nome" formControlName="nome" class="form-control" placeholder="Nome cantiere">
            @if (cantiereForm.get('nome')?.invalid && cantiereForm.get('nome')?.touched) {
            <span class="error-message">Nome obbligatorio</span>
            }
          </div>

          <div class="form-group full-width">
            <label for="indirizzo">Indirizzo *</label>
            <input type="text" id="indirizzo" formControlName="indirizzo" class="form-control"
              placeholder="Via, numero civico">
            @if (cantiereForm.get('indirizzo')?.invalid && cantiereForm.get('indirizzo')?.touched) {
            <span class="error-message">Indirizzo obbligatorio</span>
            }
          </div>

          <div class="form-group">
            <label for="citta">Città *</label>
            <input type="text" id="citta" formControlName="citta" class="form-control" placeholder="Roma">
            @if (cantiereForm.get('citta')?.invalid && cantiereForm.get('citta')?.touched) {
            <span class="error-message">Città obbligatoria</span>
            }
          </div>

          <div class="form-group">
            <label for="cap">CAP</label>
            <input type="text" id="cap" formControlName="cap" class="form-control" placeholder="00100">
          </div>

          <div class="form-group">
            <label for="provincia">Provincia</label>
            <input type="text" id="provincia" formControlName="provincia" class="form-control" placeholder="RM"
              maxlength="2">
          </div>

          <div class="form-group">
            <label for="stato">Stato *</label>
            <select id="stato" formControlName="stato" class="form-control">
              @for (statoOpt of statoOptions; track statoOpt) {
              <option [value]="statoOpt">{{ getStatoLabel(statoOpt) }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="cliente_nome">Cliente Nome</label>
            <input type="text" id="cliente_nome" formControlName="cliente_nome" class="form-control"
              placeholder="Nome">
          </div>

          <div class="form-group">
            <label for="cliente_cognome">Cliente Cognome</label>
            <input type="text" id="cliente_cognome" formControlName="cliente_cognome" class="form-control"
              placeholder="Cognome">
          </div>

          <div class="form-group">
            <label for="cliente_telefono">Cliente Telefono</label>
            <input type="tel" id="cliente_telefono" formControlName="cliente_telefono" class="form-control"
              placeholder="0123456789">
          </div>

          <div class="form-group">
            <label for="cliente_email">Cliente Email</label>
            <input type="email" id="cliente_email" formControlName="cliente_email" class="form-control"
              placeholder="email@esempio.it">
            @if (cantiereForm.get('cliente_email')?.invalid && cantiereForm.get('cliente_email')?.touched) {
            <span class="error-message">Email non valida</span>
            }
          </div>

          <div class="form-group">
            <label for="data_inizio">Data Inizio</label>
            <input type="date" id="data_inizio" formControlName="data_inizio" class="form-control">
          </div>

          <div class="form-group">
            <label for="data_fine_prevista">Data Fine Prevista</label>
            <input type="date" id="data_fine_prevista" formControlName="data_fine_prevista" class="form-control">
          </div>

          <div class="form-group">
            <label for="data_fine_effettiva">Data Fine Effettiva</label>
            <input type="date" id="data_fine_effettiva" formControlName="data_fine_effettiva" class="form-control">
          </div>

          <div class="form-group">
            <label for="budget">Budget (€)</label>
            <input type="number" id="budget" formControlName="budget" class="form-control" placeholder="0.00"
              step="0.01">
          </div>

          <div class="form-group">
            <label for="costo_effettivo">Costo Effettivo (€)</label>
            <input type="number" id="costo_effettivo" formControlName="costo_effettivo" class="form-control"
              placeholder="0.00" step="0.01">
          </div>

          <div class="form-group full-width">
            <label for="note">Note</label>
            <textarea id="note" formControlName="note" class="form-control" rows="3"
              placeholder="Note aggiuntive..."></textarea>
          </div>

          <div class="form-group full-width">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="is_attivo">
              <span>Cantiere attivo</span>
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="close()">Annulla</button>
        <button type="submit" class="btn-primary" [disabled]="cantiereForm.invalid">
          {{ isEditMode ? 'Aggiorna' : 'Salva' }}
        </button>
      </div>
    </form>
  </div>
</div>
}
